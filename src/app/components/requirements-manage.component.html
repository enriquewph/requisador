<div class="bg-white rounded-lg shadow p-6">
  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <div>
      <h2 class="text-xl font-semibold text-gray-900">Gestión de Requisitos</h2>
      <p class="text-sm text-gray-600 mt-1">Visualiza y gestiona todos los requisitos del sistema</p>
    </div>
    <div class="flex space-x-3">
      <button 
        type="button" 
        class="px-4 py-2 bg-primary-600 text-white border border-primary-600 rounded-lg transition-all duration-200 hover:bg-primary-500 hover:border-primary-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
        </svg>
        <span>Nuevo Requisito</span>
      </button>
    </div>
  </div>

  <!-- Tab View -->
  <!-- Custom Tab Navigation -->
  <nav class="bg-gray-50 border-b border-gray-200 rounded-t-lg">
    <div class="flex space-x-1 p-1">
      <button 
        type="button"
        (click)="activeSubTab.set('tree')"
        [class]="activeSubTab() === 'tree' ? 'bg-white text-primary-600 shadow-sm' : 'text-gray-500 hover:text-gray-700 hover:bg-gray-100'"
        class="px-4 py-2 rounded-md font-medium text-sm transition-all duration-200 flex items-center space-x-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
        </svg>
        <span>Vista de Árbol</span>
      </button>
      <button 
        type="button"
        (click)="activeSubTab.set('list')"
        [class]="activeSubTab() === 'list' ? 'bg-white text-primary-600 shadow-sm' : 'text-gray-500 hover:text-gray-700 hover:bg-gray-100'"
        class="px-4 py-2 rounded-md font-medium text-sm transition-all duration-200 flex items-center space-x-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/>
        </svg>
        <span>Vista de Lista</span>
      </button>
      <button 
        type="button"
        (click)="activeSubTab.set('reports')"
        [class]="activeSubTab() === 'reports' ? 'bg-white text-primary-600 shadow-sm' : 'text-gray-500 hover:text-gray-700 hover:bg-gray-100'"
        class="px-4 py-2 rounded-md font-medium text-sm transition-all duration-200 flex items-center space-x-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
        </svg>
        <span>Reportes</span>
      </button>
    </div>
  </nav>

  <!-- Tab Content -->
  <div class="bg-white border border-gray-200 border-t-0 rounded-b-lg">
    @switch (activeSubTab()) {
      @case ('tree') {
        <div class="p-6">
          <!-- Tree Actions -->
          <div class="flex justify-between items-center mb-4">
            <div class="flex space-x-3">
              <button 
                type="button" 
                class="px-3 py-2 bg-gray-100 text-gray-700 border border-gray-300 rounded-lg transition-all duration-200 hover:bg-gray-200 hover:border-gray-400 flex items-center space-x-2"
                (click)="expandAll()">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v12m6-6H6"/>
                </svg>
                <span>Expandir Todo</span>
              </button>
              <button 
                type="button" 
                class="px-3 py-2 bg-gray-100 text-gray-700 border border-gray-300 rounded-lg transition-all duration-200 hover:bg-gray-200 hover:border-gray-400 flex items-center space-x-2"
                (click)="collapseAll()">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 12H6"/>
                </svg>
                <span>Colapsar Todo</span>
              </button>
            </div>
            <div class="text-sm text-gray-600">
              Total: {{ getTotalRequirements() }} requisitos
            </div>
          </div>

        <!-- Search -->
        <div class="mb-4">
          <div class="relative">
            <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
            <input 
              type="text" 
              placeholder="Buscar requisitos..." 
              class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
              (input)="tt.filterGlobal($any($event.target).value, 'contains')"
              #globalFilter>
          </div>
        </div>

        <!-- TreeTable -->
        <p-treeTable 
          [value]="requirements()" 
          [columns]="allCols()"
          [scrollable]="true" 
          scrollHeight="500px"
          scrollDirection="both"
          [resizableColumns]="true"
          [globalFilterFields]="['textualId', 'behavior', 'condition', 'component', 'mode', 'function', 'variable', 'justification']"
          styleClass="p-treetable-sm"
          #tt>
          
          <!-- Column Headers -->
          <ng-template pTemplate="header" let-columns>
            <tr>
              @for (col of allCols(); track col.field) {
                <th [style.width]="col.width">
                  <div class="flex items-center">
                    {{ col.header }}
                  </div>
                </th>
              }
            </tr>
          </ng-template>

          <!-- Row Content -->
          <ng-template pTemplate="body" let-rowNode let-rowData="rowData" let-columns="columns">
            <tr [ttRow]="rowNode">
              @for (col of allCols(); track col.field) {
                <td>
                  @switch (col.field) {
                    @case ('textualId') {
                      <div class="flex items-center">
                        <p-treeTableToggler [rowNode]="rowNode"></p-treeTableToggler>
                        <span class="font-mono text-sm font-medium ml-2" 
                              [class]="getRequirementIdClass(rowData.level)">
                          {{ rowData.textualId }}
                        </span>
                      </div>
                    }
                    @case ('behavior') {
                      <div class="max-w-md">
                        <p class="text-sm text-gray-900 line-clamp-2" 
                           [title]="rowData.behavior">
                          {{ rowData.behavior }}
                        </p>
                      </div>
                    }
                    @case ('condition') {
                      <div class="max-w-md">
                        <p class="text-sm text-gray-600 line-clamp-1" 
                           [title]="rowData.condition">
                          {{ rowData.condition }}
                        </p>
                      </div>
                    }
                    @case ('justification') {
                      <div class="max-w-md">
                        <p class="text-sm text-gray-500 line-clamp-1" 
                           [title]="rowData.justification">
                          {{ rowData.justification }}
                        </p>
                      </div>
                    }
                    @case ('component') {
                      <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800">
                        {{ rowData.component }}
                      </span>
                    }
                    @case ('mode') {
                      <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                        {{ rowData.mode }}
                      </span>
                    }
                    @case ('function') {
                      <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                        {{ rowData.function }}
                      </span>
                    }
                    @case ('variable') {
                      <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                        {{ rowData.variable }}
                      </span>
                    }
                    @default {
                      {{ rowData[col.field] }}
                    }
                  }
                </td>
              }
            </tr>
          </ng-template>

          <!-- Empty State -->
          <ng-template pTemplate="emptymessage">
            <tr>
              <td [attr.colspan]="allCols().length" class="text-center py-8">
                <div class="flex flex-col items-center space-y-4">
                  <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                  </svg>
                  <p class="text-gray-600">No se encontraron requisitos</p>
                  <button 
                    type="button" 
                    class="px-4 py-2 bg-gray-100 text-gray-700 border border-gray-300 rounded-lg transition-all duration-200 hover:bg-gray-200 hover:border-gray-400">
                    Crear Primer Requisito
                  </button>
                </div>
              </td>
            </tr>
          </ng-template>
        </p-treeTable>
        </div>
      }
      @case ('list') {
        <div class="p-6">
          <div class="text-center py-16">
            <div class="max-w-md mx-auto">
              <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/>
              </svg>
              <h3 class="text-lg font-semibold text-gray-900 mb-2">Vista de Lista</h3>
              <p class="text-gray-600">Vista plana de todos los requisitos</p>
              <p class="text-sm text-gray-500 mt-2">Próximamente disponible</p>
            </div>
          </div>
        </div>
      }
      @case ('reports') {
        <div class="p-6">
          <div class="text-center py-16">
            <div class="max-w-md mx-auto">
              <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
              <h3 class="text-lg font-semibold text-gray-900 mb-2">Reportes y Estadísticas</h3>
              <p class="text-gray-600">Análisis y métricas de requisitos</p>
              <p class="text-sm text-gray-500 mt-2">Próximamente disponible</p>
            </div>
          </div>
        </div>
      }
    }
  </div>
</div>
